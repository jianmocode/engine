<link rel="stylesheet" href="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/lib/codemirror.css">
<link rel="stylesheet" href="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/addon/fold/foldgutter.css">
<link rel="stylesheet" href="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/addon/dialog/dialog.css">
<link rel="stylesheet" href="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/theme/monokai.css">

<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/lib/codemirror.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/addon/search/searchcursor.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/addon/search/search.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/addon/dialog/dialog.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/addon/edit/matchbrackets.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/addon/edit/closebrackets.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/addon/comment/comment.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/addon/wrap/hardwrap.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/addon/fold/foldcode.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/addon/fold/brace-fold.js"></script>

<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/mode/javascript/javascript.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/mode/shell/shell.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/mode/sql/sql.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/mode/python/python.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/mode/go/go.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/mode/php/php.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/mode/htmlmixed/htmlmixed.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/mode/xml/xml.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/mode/css/css.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/mode/sass/sass.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/mode/vue/vue.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/mode/textile/textile.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/mode/clike/clike.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/mode/markdown/markdown.js"></script>
<script src="<?=\Xpmse\Conf::G('general/static')?>/assets/js/plugins/codemirror/keymap/sublime.js"></script>


<style type="text/css">
	.form-horizontal {
		padding-top: 20px;
		padding-bottom: 40px;
	}

	.CodeMirror {
		height: auto;
	}
</style>

<div class="content">
	<div class="row">
		<div class="col-xs-8">
			<ol class="breadcrumb  font-s14">
				<li> <a href="<?=R('mina', 'codemaker', 'history')?>"> <i class="fa fa-codepen"></i> 项目列表 </a> </li>
				<li>  <?=$history['name']?> ( <?=$history['history_id']?> )  </li>
			</ol>
		</div>
		<div class="col-xs-4 text-right  font-s14">
			<a href="javascript:create();" class="push-10-r"> <i class="fa fa-plus"></i> 新建 </a>
		</div>
	</div>

	<div class="block push-20-t">
		<div class="block-wizard-header" style="border-color:#5c90d2">
			<ul class="col-xs-9">
				<li class="active" > <a href="<?=R('mina', 'codemaker', 'selectTemplate', ['code_id'=>$code_id])?>"> 第一步: 选择母版 </a> </li>
				<li class="active" > <a href="<?=R('mina', 'codemaker', 'setOption', ['page'=>$page, 'code_id'=>$code_id])?>">第二步: 设定选项</a></li>
				<li class="active"> 第三步: 生成代码</li>
			</ul>
		</div>

		<div class="block-content block-wizard-content	block-content-full row">
			
			<div class="col-xs-4" style="max-width: 300px;">
				<div id="tree"></div>
				<div>
					<a href='<?=R("mina","codemaker", "getOption", ["id"=>$history["history_id"], "output"=>1])?>' target="_blank" class="btn btn-sm btn-primary pull-right"> 配置数据 </a>
				</div>
			</div>

			<div class="col-xs-8">
				<textarea id="code-editor" style="border:none;display:none;"><?=htmlspecialchars($content)?></textarea>
			</div>
		</div>
	</div> <!--	END Block	-->
</div> <!-- END content -->

<!-- 功能操作面板-->
<div class="block block-quickpanel" style="margin-bottom: 20px;" >
	<div class="block-quickpanel-content" >
		<div class="row">
			<div class="col-xs-12 text-center" style="padding:20px;">
				<a href="javascript:deploy('<?=$history['history_id']?>', '<?=$file['name']?>');" class="btn btn-primary btn-lg btn-minw push-20-r"> <i class="fa fa-paper-plane"></i> 部署 </a>
				<a href="<?=R('mina', 'codemaker', 'download', ['id'=>$history['history_id']])?>" class="btn btn-primary btn-lg btn-minw push-20-r"> <i class="fa fa-download"></i> 下载 </a>
				<a class="btn btn-primary btn-lg btn-minw push-20-r" href="<?=R('mina', 'codemaker', 'setOption', ['page'=>$page, 'code_id'=>$code_id])?>" > <i class="fa fa-angle-double-left"></i> 上一步	</a>
				<a class="btn btn-primary btn-lg btn-minw disabled" disabled> 下一步 <i class="fa fa-angle-double-right"></i> </a>
			</div>
		</div>
	</div>
	<div class="bg-primary text-white text-center bottom-line"></div>	 
</div><!-- END 功能操作面板-->


<script type="text/javascript">
	$(function(){

		// var tree = [
		// 	{
		// 		text: "model",
		// 		selectable: false,
		// 		nodes: [

		// 			{
		// 				text: "Pet.php",
		// 				icon: "fa fa-file-code-o",
		// 				href: "<?=R('mina', 'codemaker', 'getCode', ['file'=>'Pet.php'])?>"
		// 			}
		// 		]
		// 	},{
		// 		text: "view",
		// 		selectable: false,
		// 		nodes: [
		// 			{
		// 				text: "pet",
		// 				selectable: false,
		// 				nodes: [
		// 					{
		// 						text: "index.tpl.html",
		// 						icon: "fa fa-file-code-o"
		// 					},
		// 					{
		// 						text: "detail.tpl.html",
		// 						icon: "fa fa-file-code-o"
		// 					}
		// 				]
		// 			}
		// 		]
		// 	},{
		// 		text: "README.md",
		// 		state: {
		// 			selected: true
		// 		}
		// 	}

		// ];

		var tree = <?=json_encode($files)?>;
		var treeOption = {
			collapseIcon: "fa fa-folder-open-o",
			expandIcon: "fa fa-folder-o",
			data: tree
		};

		App.initHelpers(['select2',	'ajax-confirm', 'slimscroll']);
		$('#tree').treeview(treeOption);
		$('#tree').on('nodeSelected',function(event, data) {
			var url = '<?=R("mina","codemaker", "getCode", ["code_id"=>$code_id, "page"=>$page, "name"=>""])?>' + data['name'];
			window.location = url;
		});

		$('#code-editor').height($(document).outerHeight());

		// 代码编辑器
		var editor = CodeMirror.fromTextArea(document.getElementById('code-editor'), {
			lineNumbers: true,
			mode: "<?=$file['mode']?>",
			viewportMargin: Infinity
		});

	});
</script>